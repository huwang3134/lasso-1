---
title: "Reports of MSE"
author: "Shuofan Zhang"
date: '`r format(Sys.Date(), "%B %d, %Y")`'
output: pdf_document
---

```{r, include=T, echo=F, warning=F, 	message = FALSE}
load("/Users/stanza/documents/github/lasso/sab_gdp.RData")
source("/Users/stanza/documents/github/lasso/fun.R")
library("glmnet")
library("reshape2")
library("cellranger")
library("tidyverse")
library("knitr")
library("ggrepel")
library("pander")
library("kableExtra")
library("tseries")
library("urca")
```

# Stock and Watson Dataset (GDP growth)  

## Data

Data: 145+1-5=141 series in total.

The "spread" series (difference between two I(1) series) are removed.

One of the I(1), "CP3FM" (short name: "Com Paper") was omitted in the original data set, now is added.

log() is done.

$y$ is GDP.

The earliest 80% of data were used to estimate the coefficients, the rest 20% were used to calculate the out-of-sample MSE.

```{r, include=T, echo=F, warning=F, 	message = FALSE}
D.GDP = diff(bpraw$GDP) %>% as.data.frame()
time = 1:dim(D.GDP)[1]
l = ceiling(dim(D.GDP)[1]*0.8)
ggplot(data=D.GDP, aes(x=time, y=.)) + geom_line() + 
  geom_vline(xintercept=l, color="red") + 
  xlab("time") +
  ylab("GDP Growth")
```

## ADF test  

Step 1, ADF test to the 146 original series.

Step 2, mark "I(0)" variables as "I(0)".

Step 3, ADF test to the first-differenced 146 series.

Step 4, check for contradictions, found "PCED_RecServices" in AIC.

Step 5, mark "I(1)" variable as "I(2)" (including "PCED_RecServices").

Step 6, mark the rest as "I(1)".

Step 7, repeat the above 6 steps for both "AIC" and "BIC".

## AR(p) modeL  

* The estimation method is OLS; lags are chosen by AIC.

## Lasso 1  

$$ 
\begin{split} 
\Delta y_t &=y_{t-1} \\
&+ \Delta y_{t-1} + \Delta y_{t-2} + \Delta y_{t-3} + \Delta y_{t-4} \\
&+  I(0)_{t-1} +  I(0)_{t-2} 
+  I(0)_{t-3} +  I(0)_{t-4} \\
&+  I(1)_{t-1} +  I(1)_{t-2} 
+  I(1)_{t-3} +  I(1)_{t-4} \\
&+  \Delta I(2)_{t-1} +  \Delta I(2)_{t-2} 
+  \Delta I(2)_{t-3} +  \Delta I(2)_{t-4}
\end{split} 
$$

```{r include=T, message=F, warning=F, echo=F}
#lasso1.sw = lasso111gdp(data = bpraw, tcode = t.sw)
#trace1.sw = trace.plot.table(lasso1.sw$lasso, lambda.seq, lasso1.sw$lambda)
#lasso1.aic = lasso111gdp(data = bpraw, tcode = t.aic)
#trace1.aic = trace.plot.table(lasso1.aic$lasso, lambda.seq, lasso1.aic$lambda)
#lasso1.bic = lasso111gdp(data = bpraw, tcode = t.bic)
#trace1.bic = trace.plot.table(lasso1.bic$lasso, lambda.seq, lasso1.bic$lambda)
train1.sw = GDP1train(data = bpraw, tcode = t.sw)
train1.aic = GDP1train(data = bpraw, tcode = t.aic)
train1.bic = GDP1train(data = bpraw, tcode = t.bic)
trace1.sw = trace.plot.table(train1.sw$lasso, lambda.seq, train1.sw$lambda)
trace1.aic = trace.plot.table(train1.aic$lasso, lambda.seq, train1.aic$lambda)
trace1.bic = trace.plot.table(train1.bic$lasso, lambda.seq, train1.bic$lambda)
sum1 = sumtable(trace1.sw, trace1.aic, trace1.bic)
mses1 = c("out-of sample MSE", round(train1.sw$mse, digits = 6), 
         round(train1.aic$mse, digits = 6), round(train1.bic$mse, digits = 6))
sum1 = rbind(mses1, sum1)
write.csv(sum1, file="/Users/stanza/documents/github/lasso/gdp1.csv")
MSE1 = c(train1.sw$mse, train1.aic$mse, train1.bic$mse)
```

## Lasso 2  

$$ 
\begin{split} 
\Delta y_t &=y_{t-1} \\
&+ \Delta y_{t-1} + \Delta y_{t-2} + \Delta y_{t-3} + \Delta y_{t-4} \\
&+  I(0)_{t-1} +  I(0)_{t-2} 
+  I(0)_{t-3} +  I(0)_{t-4} \\
&+  \Delta I(1)_{t-1} +  \Delta I(1)_{t-2} 
+  \Delta I(1)_{t-3} +  \Delta I(1)_{t-4} \\
&+  \Delta^2 I(2)_{t-1} +  \Delta^2 I(2)_{t-2} 
+  \Delta^2 I(2)_{t-3} +  \Delta^2 I(2)_{t-4}
\end{split} 
$$


```{r include=T, message=F, warning=F, echo=F}
#lasso2.sw = lasso222gdp(data = bpraw, tcode = t.sw)
#trace2.sw = trace.plot.table(lasso2.sw$lasso, lambda.seq, lasso2.sw$lambda)
#lasso2.aic = lasso222gdp(data = bpraw, tcode = t.aic)
#trace2.aic = trace.plot.table(lasso2.aic$lasso, lambda.seq, lasso2.aic$lambda)
#lasso2.bic = lasso222gdp(data = bpraw, tcode = t.bic)
#trace2.bic = trace.plot.table(lasso2.bic$lasso, lambda.seq, lasso2.bic$lambda)
train2.sw = GDP2train(data = bpraw, tcode = t.sw)
train2.aic = GDP2train(data = bpraw, tcode = t.aic)
train2.bic = GDP2train(data = bpraw, tcode = t.bic)
trace2.sw = trace.plot.table(train2.sw$lasso, lambda.seq, train2.sw$lambda)
trace2.aic = trace.plot.table(train2.aic$lasso, lambda.seq, train2.aic$lambda)
trace2.bic = trace.plot.table(train2.bic$lasso, lambda.seq, train2.bic$lambda)
sum2 = sumtable(trace2.sw, trace2.aic, trace2.bic)
mses2 = c("out-of sample MSE", round(train2.sw$mse, digits = 6), 
         round(train2.aic$mse, digits = 6), round(train2.bic$mse, digits = 6))
sum2 = rbind(mses2, sum2)
MSE2 = c(train2.sw$mse, train2.aic$mse, train2.bic$mse)
write.csv(sum2, file="/Users/stanza/documents/github/lasso/gdp2.csv")
```

## Lasso 3

$$ 
\begin{split} 
\Delta y_t &=y_{t-1} \\
&+ \Delta y_{t-1} + \Delta y_{t-2} + \Delta y_{t-3} + \Delta y_{t-4} \\
&+  I(0)_{t-1} +  I(0)_{t-2} 
+  I(0)_{t-3} +  I(0)_{t-4} \\
&+  \Delta I(1)_{t-1} +  \Delta I(1)_{t-2} 
+  \Delta I(1)_{t-3} +  \Delta I(1)_{t-4} \\
&+  \Delta^2 I(2)_{t-1} +  \Delta^2 I(2)_{t-2} 
+  \Delta^2 I(2)_{t-3} +  \Delta^2 I(2)_{t-4} \\
&+ I(1)_{t-1} + \Delta I(2)_{t-1}
\end{split} 
$$

```{r include=T, message=F, warning=F, echo=F}
#lasso3.sw = lasso333gdp(data = bpraw, tcode = t.sw)
#trace3.sw = trace.plot.table(lasso3.sw$lasso, lambda.seq, lasso3.sw$lambda)
#lasso3.aic = lasso333gdp(data = bpraw, tcode = t.aic)
#trace3.aic = trace.plot.table(lasso3.aic$lasso, lambda.seq, lasso3.aic$lambda)
#lasso3.bic = lasso333gdp(data = bpraw, tcode = t.bic)
#trace3.bic = trace.plot.table(lasso3.bic$lasso, lambda.seq, lasso3.bic$lambda)
train3.sw = GDP3train(data = bpraw, tcode = t.sw)
train3.aic = GDP3train(data = bpraw, tcode = t.aic)
train3.bic = GDP3train(data = bpraw, tcode = t.bic)
trace3.sw = trace.plot.table(train3.sw$lasso, lambda.seq, train3.sw$lambda)
trace3.aic = trace.plot.table(train3.aic$lasso, lambda.seq, train3.aic$lambda)
trace3.bic = trace.plot.table(train3.bic$lasso, lambda.seq, train3.bic$lambda)
sum3 = sumtable(trace3.sw, trace3.aic, trace3.bic)
mses3 = c("out-of sample MSE", round(train3.sw$mse, digits = 6), 
         round(train3.aic$mse, digits = 6), round(train3.bic$mse, digits = 6))
sum3 = rbind(mses3, sum3)
write.csv(sum3, file="/Users/stanza/documents/github/lasso/gdp3.csv")
MSE3 = c(train3.sw$mse, train3.aic$mse, train3.bic$mse)
mses = rbind(MSE1, MSE2, MSE3)
colnames(mses) = c("SW", "AIC", "BIC")
rownames(mses) = c("LASSO 1", "LASSO 2", "LASSO 3")
pander(mses, caption = "out-of-sample MSE, when the dependent variable is inflation")
```

* AIC chooses 2 lags for the GDP growth.

* The out-of-sample MSE of AR(2) is 0.89.

* The estimated AR(1) coefficient is 0.3078.

```{r include=T, message=F, warning=F, echo=F}
D.GDP = diff(bpraw$GDP)
#ar(D.GDP, order.max = 1)
#ar(D.GDP, aic = TRUE)
maxlag.GDP = 2
y = lag0(maxlag = maxlag.GDP, D.GDP) %>% scale()
x = lags(maxlag = maxlag.GDP, D.GDP) 
l = ceiling(length(y)*0.8)
y.train = y[1:l]
y.test = y[(l+1):length(y)]
x.train = x[1:l, ] 
x.test = x[(l+1):dim(x)[1], ]
GDPols = lm(y.train ~ x.train)
cf = as.data.frame(lapply(GDPols$coefficients[-1], rep, dim(x.test)[1]))
fit.temp = cf * x.test
fit.GDP = rowSums(fit.temp)
out.mse.GDP = mean((y.test-fit.GDP)^2)
trace.interest(train1.sw$lasso, lambda.seq) 
#out.mse.GDP
```

The trace plot shows the paths of the four lags of the two interest rates that are I(1) variables: "3-month treasury bill (TB-3Mth)" and "3-Month AA Financial Commercial Paper Rate post 1997 â€¦ linked to XLI CP90 before 1997 (Com Paper)". 

Previously, when we had the difference of these two variables "CP_Tbill Spread" in the data, it was selected by the LASSO and the absolute value of its coefficient was the biggest among other non-zero coefficients. Since we have removed all the spreads in the data, I try to figure out what is happening to the two "parents" I(1) variables.
 
From the graph, we see:

1, when $\lambda=0$, which is the OLS, the magnitude and signs of the estimated coefficients all make sense, for example, lag-1 of TB-3Mth is positive and has a big coefficient, while lag-1 of Com Paper is negative and also has a big absolute coefficient. I think this may indicate that OLS works OK in terms of estimating co-integrating vectors.

2, Once $\lambda$ becomes non-zero, (in our case, the smallest non-zero $\lambda=0$ is 0.0025) seven out of eight of these variables are dropped immediately, which is a bit disappointing. 

Note: Although this graph only shows the trace of eight variables (two series with four lags), the regression was conducted with all 146 variables.

# Stock and Watson Dataset (Inflation)  

* Stock and Watson twice differenced the CPI to make it stationary.

* ADF test with AIC/BIC conclude Inflation as I(0) with full set of observations.

* ADF test with AIC/BIC conclude Inflation as I(1) with the first 80% of observations.


```{r, echo=F, message=F, warning=F}
t.inf = t.sw
t.inf[short=="CPI"] = "1"
Inflation = diff(bpraw$CPI) %>% as.data.frame()
time = 1:dim(Inflation)[1]
l = ceiling(dim(Inflation)[1]*0.8)
ggplot(data=Inflation, aes(x=time, y=.)) + geom_line() + 
  geom_vline(xintercept=l, color="red") + 
  xlab("time") +
  ylab("GDP Growth")
```

## Inflation as I(0)


```{r include=T, message=F, warning=F, echo=F}
#lasso1.sw = lasso111inf(data = bpraw, tcode = t.inf)
#trace1.sw = trace.plot.table(lasso1.sw$lasso, lambda.seq, lasso1.sw$lambda)
#lasso1.aic = lasso111inf(data = bpraw, tcode = t.aic)
#trace1.aic = trace.plot.table(lasso1.aic$lasso, lambda.seq, lasso1.aic$lambda)
#lasso1.bic = lasso111inf(data = bpraw, tcode = t.bic)
#trace1.bic = trace.plot.table(lasso1.bic$lasso, lambda.seq, lasso1.bic$lambda)
train1.sw = inf1train(data = bpraw, tcode = t.sw)
train1.aic = inf1train(data = bpraw, tcode = t.aic)
train1.bic = inf1train(data = bpraw, tcode = t.bic)
trace1.sw = trace.plot.table(train1.sw$lasso, lambda.seq, train1.sw$lambda)
trace1.aic = trace.plot.table(train1.aic$lasso, lambda.seq, train1.aic$lambda)
trace1.bic = trace.plot.table(train1.bic$lasso, lambda.seq, train1.bic$lambda)
sum1 = sumtable(trace1.sw, trace1.aic, trace1.bic)
mses1 = c("out-of sample MSE", round(train1.sw$mse, digits = 6), 
         round(train1.aic$mse, digits = 6), round(train1.bic$mse, digits = 6))
sum1 = rbind(mses1, sum1)
MSE1 = c(train1.sw$mse, train1.aic$mse, train1.bic$mse)
write.csv(sum1, "/Users/stanza/documents/github/lasso/inf1.csv")
```

```{r include=T, message=F, warning=F, echo=F}
#lasso2.sw = lasso222inf(data = bpraw, tcode = t.inf)
#trace2.sw = trace.plot.table(lasso2.sw$lasso, lambda.seq, lasso2.sw$lambda)
#lasso2.aic = lasso222inf(data = bpraw, tcode = t.aic)
#trace2.aic = trace.plot.table(lasso2.aic$lasso, lambda.seq, lasso2.aic$lambda)
#lasso2.bic = lasso222inf(data = bpraw, tcode = t.bic)
#trace2.bic = trace.plot.table(lasso2.bic$lasso, lambda.seq, lasso2.bic$lambda)
train2.sw = inf2train(data = bpraw, tcode = t.sw)
train2.aic = inf2train(data = bpraw, tcode = t.aic)
train2.bic = inf2train(data = bpraw, tcode = t.bic)
trace2.sw = trace.plot.table(train2.sw$lasso, lambda.seq, train2.sw$lambda)
trace2.aic = trace.plot.table(train2.aic$lasso, lambda.seq, train2.aic$lambda)
trace2.bic = trace.plot.table(train2.bic$lasso, lambda.seq, train2.bic$lambda)
sum2 = sumtable(trace2.sw, trace2.aic, trace2.bic)
mses2 = c("out-of sample MSE", round(train2.sw$mse, digits = 6), 
         round(train2.aic$mse, digits = 6), round(train2.bic$mse, digits = 6))
sum2 = rbind(mses2, sum2)
MSE2 = c(train2.sw$mse, train2.aic$mse, train2.bic$mse)
write.csv(sum2, "/Users/stanza/documents/github/lasso/inf2.csv")
```

```{r include=T, message=F, warning=F, echo=F}
#lasso3.sw = lasso333inf(data = bpraw, tcode = t.inf)
#trace3.sw = trace.plot.table(lasso3.sw$lasso, lambda.seq, lasso3.sw$lambda)
#lasso3.aic = lasso333inf(data = bpraw, tcode = t.aic)
#trace3.aic = trace.plot.table(lasso3.aic$lasso, lambda.seq, lasso3.aic$lambda)
#lasso3.bic = lasso333inf(data = bpraw, tcode = t.bic)
#trace3.bic = trace.plot.table(lasso3.bic$lasso, lambda.seq, lasso3.bic$lambda)
train3.sw = inf3train(data = bpraw, tcode = t.sw)
train3.aic = inf3train(data = bpraw, tcode = t.aic)
train3.bic = inf3train(data = bpraw, tcode = t.bic)
trace3.sw = trace.plot.table(train3.sw$lasso, lambda.seq, train3.sw$lambda)
trace3.aic = trace.plot.table(train3.aic$lasso, lambda.seq, train3.aic$lambda)
trace3.bic = trace.plot.table(train3.bic$lasso, lambda.seq, train3.bic$lambda)
sum3 = sumtable(trace3.sw, trace3.aic, trace3.bic)
mses3 = c("out-of sample MSE", round(train3.sw$mse, digits = 6), 
         round(train3.aic$mse, digits = 6), round(train3.bic$mse, digits = 6))
sum3 = rbind(mses3, sum3)
MSE3 = c(train3.sw$mse, train3.aic$mse, train3.bic$mse)
write.csv(sum3, "/Users/stanza/documents/github/lasso/inf3.csv")
mses = rbind(MSE1, MSE2, MSE3)
colnames(mses) = c("SW", "AIC", "BIC")
rownames(mses) = c("LASSO 1", "LASSO 2", "LASSO 3")
pander(mses, caption = "out-of-sample MSE, when the dependent variable is inflation")
```


* AIC chooses 3 lags for Inflation.

* The out-of-sample MSE of AR(3) is 2.266.

* The estimated AR(1) coefficient is 0.7565.


```{r include=T, message=F, warning=F, echo=F}
#ar(D.Inflation, aic = TRUE)
maxlag.inf = 3
Inflation = diff(bpraw$CPI)
y = lag0(maxlag = maxlag.inf, Inflation) %>% scale()
x = lags(maxlag = maxlag.inf, Inflation) 
l = ceiling(length(y)*0.8)
y.train = y[1:l]
y.test = y[(l+1):length(y)]
x.train = x[1:l, ] 
x.test = x[(l+1):dim(x)[1], ]
infols = lm(y.train ~ x.train)
cf = as.data.frame(lapply(infols$coefficients[-1], rep, dim(x.test)[1]))
fit.temp = cf * x.test
fit.inf = rowSums(fit.temp)
out.mse.inf = mean((y.test-fit.inf)^2)
#out.mse.inf
#ar(Inflation, order.max = 1)
rbind(adf.auto(Inflation, criteria = "AIC"), adf.auto(Inflation, criteria = "BIC"), adf.auto(y.train, criteria = "AIC"), adf.auto(y.train, criteria = "BIC")) %>% pander(caption="ADF test for Inflation")
```

## Inflation as I(1)

```{r include=T, message=F, warning=F, echo=F}
D.Inflation = diff(Inflation) %>% as.data.frame()
#ar(D.Inflation, order.max = 1)
time = 1:dim(D.Inflation)[1]
l = ceiling(dim(D.Inflation)[1]*0.8)
ggplot(data=D.Inflation, aes(x=time, y=.)) + geom_line() + geom_vline(xintercept=l, color="red")
```

```{r include=T, message=F, warning=F, echo=F}
t.aic.2 = t.aic
t.aic.2[short=="CPI"] = "2"
t.bic.2 = t.bic
t.bic.2[short=="CPI"] = "2"
#lasso1.sw2 = lasso111inf2(data = bpraw, tcode = t.sw)
#trace1.sw2 = trace.plot.table(lasso1.sw2$lasso, lambda.seq, lasso1.sw2$lambda)
#lasso1.aic2 = lasso111inf2(data = bpraw, tcode = t.aic.2)
#trace1.aic2 = trace.plot.table(lasso1.aic2$lasso, lambda.seq, lasso1.aic2$lambda)
#lasso1.bic2 = lasso111inf2(data = bpraw, tcode = t.bic.2)
#trace1.bic2 = trace.plot.table(lasso1.bic2$lasso, lambda.seq, lasso1.bic2$lambda)
train1.2.sw = inf1.2train(data = bpraw, tcode = t.sw)
train1.2.aic = inf1.2train(data = bpraw, tcode = t.aic.2)
train1.2.bic = inf1.2train(data = bpraw, tcode = t.bic.2)
trace1.2.sw = trace.plot.table(train1.2.sw$lasso, lambda.seq, train1.2.sw$lambda)
trace1.2.aic = trace.plot.table(train1.2.aic$lasso, lambda.seq, train1.2.aic$lambda)
trace1.2.bic = trace.plot.table(train1.2.bic$lasso, lambda.seq, train1.2.bic$lambda)
sum1.2 = sumtable(trace1.2.sw, trace1.2.aic, trace1.2.bic)
mses1.2 = c("out-of sample MSE", round(train1.2.sw$mse, digits = 6), 
         round(train1.2.aic$mse, digits = 6), round(train1.2.bic$mse, digits = 6))
sum1.2 = rbind(mses1.2, sum1.2)
MSE1.2 = c(train1.2.sw$mse, train1.2.aic$mse, train1.2.bic$mse)
write.csv(sum1.2, "/Users/stanza/documents/github/lasso/inf1_2.csv")
```

```{r include=T, message=F, warning=F, echo=F}
#lasso2.sw2 = lasso222inf(data = bpraw, tcode = t.sw)
#trace2.sw2 = trace.plot.table(lasso2.sw2$lasso, lambda.seq, lasso2.sw2$lambda)
#lasso2.aic2 = lasso222inf(data = bpraw, tcode = t.aic.2)
#trace2.aic2 = trace.plot.table(lasso2.aic2$lasso, lambda.seq, lasso2.aic2$lambda)
#lasso2.bic2 = lasso222inf(data = bpraw, tcode = t.bic.2)
#trace2.bic2 = trace.plot.table(lasso2.bic2$lasso, lambda.seq, lasso2.bic2$lambda)
train2.2.sw = inf2.2train(data = bpraw, tcode = t.sw)
train2.2.aic = inf2.2train(data = bpraw, tcode = t.aic.2)
train2.2.bic = inf2.2train(data = bpraw, tcode = t.bic.2)
trace2.2.sw = trace.plot.table(train2.2.sw$lasso, lambda.seq, train2.2.sw$lambda)
trace2.2.aic = trace.plot.table(train2.2.aic$lasso, lambda.seq, train2.2.aic$lambda)
trace2.2.bic = trace.plot.table(train2.2.bic$lasso, lambda.seq, train2.2.bic$lambda)
sum2.2 = sumtable(trace2.2.sw, trace2.2.aic, trace2.2.bic)
mses2.2 = c("out-of sample MSE", round(train2.2.sw$mse, digits = 6), 
         round(train2.2.aic$mse, digits = 6), round(train2.2.bic$mse, digits = 6))
sum2.2 = rbind(mses2.2, sum2.2)
MSE2.2 = c(train2.2.sw$mse, train2.2.aic$mse, train2.2.bic$mse)
write.csv(sum2.2, "/Users/stanza/documents/github/lasso/inf2_2.csv")
```

```{r include=T, message=F, warning=F, echo=F}
#lasso3.sw2 = lasso333inf(data = bpraw, tcode = t.sw)
#trace3.sw2 = trace.plot.table(lasso3.sw2$lasso, lambda.seq, lasso3.sw2$lambda)
#lasso3.aic2 = lasso333inf(data = bpraw, tcode = t.aic.2)
#trace3.aic2 = trace.plot.table(lasso3.aic2$lasso, lambda.seq, lasso3.aic2$lambda)
#lasso3.bic2 = lasso333inf(data = bpraw, tcode = t.bic.2)
#trace3.bic2 = trace.plot.table(lasso3.bic2$lasso, lambda.seq, lasso3.bic2$lambda)
train3.2.sw = inf3.2train(data = bpraw, tcode = t.sw)
train3.2.aic = inf3.2train(data = bpraw, tcode = t.aic.2)
train3.2.bic = inf3.2train(data = bpraw, tcode = t.bic.2)
trace3.2.sw = trace.plot.table(train3.2.sw$lasso, lambda.seq, train3.2.sw$lambda)
trace3.2.aic = trace.plot.table(train3.2.aic$lasso, lambda.seq, train3.2.aic$lambda)
trace3.2.bic = trace.plot.table(train3.2.bic$lasso, lambda.seq, train3.2.bic$lambda)
sum3.2 = sumtable(trace3.2.sw, trace3.2.aic, trace3.2.bic)
mses3.2 = c("out-of sample MSE", round(train3.2.sw$mse, digits = 6), 
         round(train3.2.aic$mse, digits = 6), round(train3.2.bic$mse, digits = 6))
sum3.2 = rbind(mses3.2, sum3.2)
MSE3.2 = c(train3.2.sw$mse, train3.2.aic$mse, train3.2.bic$mse)
write.csv(sum3.2, "/Users/stanza/documents/github/lasso/inf3_2.csv")
mses.2 = rbind(MSE1.2, MSE2.2, MSE3.2)
colnames(mses.2) = c("SW", "AIC", "BIC")
rownames(mses.2) = c("LASSO 1", "LASSO 2", "LASSO 3")
pander(mses.2, caption = "out-of-sample MSE, when the dependent variable is first-differenced inflation")
```


* AIC chooses 4 lags for the first-differenced inflation.

* The out-of-sample MSE of AR(4) is 1.969.

* The estimated AR(1) coefficient is -0.2728.


```{r include=T, message=F, warning=F, echo=F}
# differenced inflation
maxlag.d.inf = 4
D.Inflation = diff(Inflation)
y = lag0(maxlag = maxlag.d.inf, D.Inflation) %>% scale()
x = lags(maxlag = maxlag.d.inf, D.Inflation) 
l = ceiling(length(y)*0.8)
y.train = y[1:l]
y.test = y[(l+1):length(y)]
x.train = x[1:l, ] 
x.test = x[(l+1):dim(x)[1], ]
infols = lm(y.train ~ x.train)
cf = as.data.frame(lapply(infols$coefficients[-1], rep, dim(x.test)[1]))
fit.temp = cf * x.test
fit.inf = rowSums(fit.temp)
out.mse.Dinf = mean((y.test-fit.inf)^2)
#out.mse.Dinf
```


```{r, include=T, echo=F, warning=F, 	message = FALSE}

load("/Users/stanza/documents/github/lasso/ng/ngdata.RData")


time = 1:dim(ydata)[1]
l = ceiling(dim(ydata)[1]*0.8)
ggplot(data=ydata, aes(x=time, y=yr2)) + geom_line() + geom_vline(xintercept=l, color="red")

aic.trend = adf.auto(as.data.frame(ydata[,-5]), criteria = "AIC")
bic.trend = adf.auto(as.data.frame(ydata[,-5]), criteria = "BIC")
aic.drift = adf.drift(as.data.frame(ydata[,-5]), criteria = "AIC")
bic.drift = adf.drift(as.data.frame(ydata[,-5]), criteria = "BIC")
adftests = rbind(cbind(aic.trend, bic.trend), cbind(aic.drift, bic.drift)) 
```

# NG Dataset (bond returns)

Data: 131-8=123 series in total, 480 observations.

The "spread" series (difference between two I(1) series) are removed.

log() is done.

ADF test suggest I(0) for all four bond returns, whether use "trend" or "drift" specification.

## Lasso 1

I(2) is first differenced, others are original.

$$ 
\begin{split} 
y_t &= I(0)_{t-1} +  I(0)_{t-2} 
+  I(0)_{t-3} +  I(0)_{t-4} \\
&+  I(1)_{t-1} +  I(1)_{t-2} 
+  I(1)_{t-3} +  I(1)_{t-4} \\
&+  \Delta I(2)_{t-1} +  \Delta I(2)_{t-2} 
+  \Delta I(2)_{t-3} +  \Delta I(2)_{t-4}
\end{split} 
$$

```{r include=T, message=F, warning=F, echo=F}
train1.ng = ng1train(data = ngraw, tcode = t.ng, yr=yr2)
train1.aic = ng1train(data = ngraw, tcode = t.aic, yr=yr2)
train1.bic = ng1train(data = ngraw, tcode = t.bic, yr=yr2)
trace1.ng = trace.plot.table(train1.ng$lasso, lambda.seq, train1.ng$lambda)
trace1.aic = trace.plot.table(train1.aic$lasso, lambda.seq, train1.aic$lambda)
trace1.bic = trace.plot.table(train1.bic$lasso, lambda.seq, train1.bic$lambda)
sum1 = sumtable(trace1.ng, trace1.aic, trace1.bic)
mses1 = c("out-of sample MSE", round(train1.ng$mse, digits = 6), 
         round(train1.aic$mse, digits = 6), round(train1.bic$mse, digits = 6))
sum1 = rbind(mses1, sum1)
MSE1 = c(train1.ng$mse, train1.aic$mse, train1.bic$mse)
write.csv(sum1, "/Users/stanza/documents/github/lasso/ng/lasso1.csv")
```

```{r eval=F, include=F, message=F, warning=F, echo=F}
# detrend y data
lasso1.ng.dt = lasso111ng(data = ngraw, tcode = t.ng, yr = dt.yr2)
trace1.ng.dt = trace.plot.table(lasso1.ng.dt$lasso, lambda.seq, lasso1.ng.dt$lambda)
lasso1.aic.dt = lasso111ng(data = ngraw, tcode = t.aic, yr = dt.yr2)
trace1.aic.dt = trace.plot.table(lasso1.aic.dt$lasso, lambda.seq, lasso1.aic.dt$lambda)
lasso1.bic.dt = lasso111ng(data = ngraw, tcode = t.bic, yr = dt.yr2)
trace1.bic.dt = trace.plot.table(lasso1.bic.dt$lasso, lambda.seq, lasso1.bic.dt$lambda)

sum1.dt = sumtable(trace1.ng.dt, trace1.aic.dt, trace1.bic.dt)
#sum1.dt = cbind(I1=c("BIC", "BIC", "ALL", "ALL", "AIC, BIC", "ALL", "ALL", "AIC, BIC"), sum1.dt)
colnames(sum1.dt) = c("", "NG", "AIC", "BIC")
#pander(sum1.dt, caption = "Lasso 1, non-zero coefficients, detrended y series")
write.csv(sum1.dt, "/Users/stanza/documents/github/lasso/ng/lasso1_dt.csv")
```

```{r eval=F, include=F, message=F, warning=F, echo=F}
# first-differenced y data
lasso1.ng.fd = lasso111ng(data = ngraw[-1,], tcode = t.ng, yr=fd.yr2)
trace1.ng.fd = trace.plot.table(lasso1.ng.fd$lasso, lambda.seq.fd, lasso1.ng.fd$lambda)
lasso1.aic.fd = lasso111ng(data = ngraw[-1,], tcode = t.aic, yr=fd.yr2)
trace1.aic.fd = trace.plot.table(lasso1.aic.fd$lasso, lambda.seq.fd, lasso1.aic.fd$lambda)
lasso1.bic.fd = lasso111ng(data = ngraw[-1,], tcode = t.bic, yr=fd.yr2)
trace1.bic.fd = trace.plot.table(lasso1.bic.fd$lasso, lambda.seq.fd, lasso1.bic.fd$lambda)

sum1.fd = sumtable(trace1.ng.fd, trace1.aic.fd, trace1.bic.fd)
colnames(sum1.fd) = c("", "NG", "AIC", "BIC")
#pander(sum1.fd, caption = "Lasso 1, non-zero coefficients, detrended y series")
write.csv(sum1.fd, "/Users/stanza/documents/github/lasso/ng/lasso1_fd.csv")
```

## Lasso 2

All stationary.

$$ 
\begin{split} 
y_t &= I(0)_{t-1} +  I(0)_{t-2} 
+  I(0)_{t-3} +  I(0)_{t-4} \\
&+  \Delta I(1)_{t-1} +  \Delta I(1)_{t-2} 
+  \Delta I(1)_{t-3} +  \Delta I(1)_{t-4} \\
&+  \Delta^2 I(2)_{t-1} +  \Delta^2 I(2)_{t-2} 
+  \Delta^2 I(2)_{t-3} +  \Delta^2 I(2)_{t-4}
\end{split} 
$$


```{r include=T, message=F, warning=F, echo=F}
train2.ng = ng2train(data = ngraw, tcode = t.ng, yr=yr2)
train2.aic = ng2train(data = ngraw, tcode = t.aic, yr=yr2)
train2.bic = ng2train(data = ngraw, tcode = t.bic, yr=yr2)
trace2.ng = trace.plot.table(train2.ng$lasso, lambda.seq, train2.ng$lambda)
trace2.aic = trace.plot.table(train2.aic$lasso, lambda.seq, train2.aic$lambda)
trace2.bic = trace.plot.table(train2.bic$lasso, lambda.seq, train2.bic$lambda)
sum2 = sumtable(trace2.ng, trace2.aic, trace2.bic)
mses2 = c("out-of sample MSE", round(train2.ng$mse, digits = 6), 
         round(train2.aic$mse, digits = 6), round(train2.bic$mse, digits = 6))
sum2 = rbind(mses2, sum2)
MSE2 = c(train2.ng$mse, train2.aic$mse, train2.bic$mse)
write.csv(sum2, "/Users/stanza/documents/github/lasso/ng/lasso2.csv")
```

```{r eval=F, include=F, message=F, warning=F, echo=F}
# detrend y data
lasso2.ng.dt = lasso222ng(data = ngraw, tcode = t.ng, yr=dt.yr2)
trace2.ng.dt = trace.plot.table(lasso2.ng.dt$lasso, lambda.seq, lasso2.ng.dt$lambda)
lasso2.aic.dt = lasso222ng(data = ngraw, tcode = t.aic, yr=dt.yr2)
trace2.aic.dt = trace.plot.table(lasso2.aic.dt$lasso, lambda.seq, lasso2.aic.dt$lambda)
lasso2.bic.dt = lasso222ng(data = ngraw, tcode = t.bic, yr=dt.yr2)
trace2.bic.dt = trace.plot.table(lasso2.bic.dt$lasso, lambda.seq, lasso2.bic.dt$lambda)
sum2.dt = sumtable(trace2.ng.dt, trace2.aic.dt, trace2.bic.dt)
colnames(sum2.dt) = c("", "NG", "AIC", "BIC")
#pander(sum2.dt, caption = "Lasso 2, non-zero coefficients, detrended y series")
write.csv(sum2.dt, "/Users/stanza/documents/github/lasso/ng/lasso2_dt.csv")
```

```{r eval=F, include=F, message=F, warning=F, echo=F}
# first-differenced y data
lasso2.ng.fd = lasso222ng(data = ngraw[-1,], tcode = t.ng, yr=fd.yr2)
trace2.ng.fd = trace.plot.table(lasso2.ng.fd$lasso, lambda.seq.fd, lasso2.ng.fd$lambda)
lasso2.aic.fd = lasso222ng(data = ngraw[-1,], tcode = t.aic, yr=fd.yr2)
trace2.aic.fd = trace.plot.table(lasso2.aic.fd$lasso, lambda.seq.fd, lasso2.aic.fd$lambda)
lasso2.bic.fd = lasso222ng(data = ngraw[-1,], tcode = t.bic, yr=fd.yr2)
trace2.bic.fd = trace.plot.table(lasso2.bic.fd$lasso, lambda.seq.fd, lasso2.bic.fd$lambda)
sum2.fd = sumtable(trace2.ng.fd, trace2.aic.fd, trace2.bic.fd)
colnames(sum2.fd) = c("", "NG", "AIC", "BIC")
#pander(sum2.fd, caption = "Lasso 2, non-zero coefficients, detrended y series")
write.csv(sum2.fd, "/Users/stanza/documents/github/lasso/ng/lasso2_fd.csv")
```

## Lasso 3

Combination of Lasso 1 and 2.

$$ 
\begin{split} 
y_t &=I(0)_{t-1} +  I(0)_{t-2} 
+  I(0)_{t-3} +  I(0)_{t-4} \\
&+  \Delta I(1)_{t-1} +  \Delta I(1)_{t-2} 
+  \Delta I(1)_{t-3} +  \Delta I(1)_{t-4} \\
&+  \Delta^2 I(2)_{t-1} +  \Delta^2 I(2)_{t-2} 
+  \Delta^2 I(2)_{t-3} +  \Delta^2 I(2)_{t-4} \\
&+ I(1)_{t-1} + \Delta I(2)_{t-1}
\end{split} 
$$

```{r include=T, message=F, warning=F, echo=F}
train3.ng = ng3train(data = ngraw, tcode = t.ng, yr=yr2)
train3.aic = ng3train(data = ngraw, tcode = t.aic, yr=yr2)
train3.bic = ng3train(data = ngraw, tcode = t.bic, yr=yr2)
trace3.ng = trace.plot.table(train3.ng$lasso, lambda.seq, train3.ng$lambda)
trace3.aic = trace.plot.table(train3.aic$lasso, lambda.seq, train3.aic$lambda)
trace3.bic = trace.plot.table(train3.bic$lasso, lambda.seq, train3.bic$lambda)
sum3 = sumtable(trace3.ng, trace3.aic, trace3.bic)
mses3 = c("out-of sample MSE", round(train3.ng$mse, digits = 6), 
         round(train3.aic$mse, digits = 6), round(train3.bic$mse, digits = 6))
sum3 = rbind(mses3, sum3)
MSE3 = c(train3.ng$mse, train3.aic$mse, train3.bic$mse)
write.csv(sum3, "/Users/stanza/documents/github/lasso/ng/lasso3.csv")
mses = rbind(MSE1, MSE2, MSE3)
colnames(mses) = c("NG", "AIC", "BIC")
rownames(mses) = c("LASSO 1", "LASSO 2", "LASSO 3")
```

## yr2 as the dependent variable

* AIC chooses 13 lags for yr2.

* The out-of-sample MSE of AR(13) is 0.091.

* The estimated AR(1) coefficient is 0.9308.

```{r include=T, message=F, warning=F, echo=F}
pander(mses, caption = "out-of-sample MSE of LASSO, when the dependent variable is YR2")
maxlag.ar = 13
y = lag0(maxlag = maxlag.ar, yr2) %>% scale()
x = lags(maxlag = maxlag.ar, yr2) 
l = ceiling(length(y)*0.8)
y.train = y[1:l]
y.test = y[(l+1):length(y)]
x.train = x[1:l, ] 
x.test = x[(l+1):dim(x)[1], ]
arols = lm(y.train ~ x.train)
cf = as.data.frame(lapply(arols$coefficients[-1], rep, dim(x.test)[1]))
fit.temp = cf * x.test
fit.ar = rowSums(fit.temp)
out.mse.ar = mean((y.test-fit.ar)^2)
#out.mse.ar
```

```{r eval=F, include=F, message=F, warning=F, echo=F}
# detrend y data
lasso3.ng.dt = lasso333ng(data = ngraw, tcode = t.ng, yr=dt.yr3)
trace3.ng.dt = trace.plot.table(lasso3.ng.dt$lasso, lambda.seq, lasso3.ng.dt$lambda)
lasso3.aic.dt = lasso333ng(data = ngraw, tcode = t.aic, yr=dt.yr3)
trace3.aic.dt = trace.plot.table(lasso3.aic.dt$lasso, lambda.seq, lasso3.aic.dt$lambda)
lasso3.bic.dt = lasso333ng(data = ngraw, tcode = t.bic, yr=dt.yr3)
trace3.bic.dt = trace.plot.table(lasso3.bic.dt$lasso, lambda.seq, lasso3.bic.dt$lambda)
sum3.dt = sumtable(trace3.ng.dt, trace3.aic.dt, trace3.bic.dt)
colnames(sum3.dt) = c("", "NG", "AIC", "BIC")
#pander(sum3.dt, caption = "Lasso 3, non-zero coefficients, detrended y series")
write.csv(sum3.dt, "/Users/stanza/documents/github/lasso/ng/lasso3_dt.csv")
```

```{r eval=F, include=F, message=F, warning=F, echo=F}
# first-differenced y data
lasso3.ng.fd = lasso333ng(data = ngraw[-1,], tcode = t.ng, yr=fd.yr2)
trace3.ng.fd = trace.plot.table(lasso3.ng.fd$lasso, lambda.seq.fd, lasso3.ng.fd$lambda)
lasso3.aic.fd = lasso333ng(data = ngraw[-1,], tcode = t.aic, yr=fd.yr2)
trace3.aic.fd = trace.plot.table(lasso3.aic.fd$lasso, lambda.seq.fd, lasso3.aic.fd$lambda)
lasso3.bic.fd = lasso333ng(data = ngraw[-1,], tcode = t.bic, yr=fd.yr2)
trace3.bic.fd = trace.plot.table(lasso3.bic.fd$lasso, lambda.seq.fd, lasso3.bic.fd$lambda)
sum3.fd = sumtable(trace3.ng.fd, trace3.aic.fd, trace3.bic.fd)
colnames(sum3.fd) = c("", "NG", "AIC", "BIC")
#pander(sum3.fd, caption = "Lasso 3, non-zero coefficients, detrended y series")
write.csv(sum3.fd, "/Users/stanza/documents/github/lasso/ng/lasso3_fd.csv")
```


```{r include=F, message=F, warning=F, echo=F, eval=F}
description = data.frame(`Short description` = c("hsmw",
                                   "hsbsou",
                                   "lhel",
                                   "fygt1",
                                   "exrjan",
                                   "exrcan",
                                   "lhu680",
                                   "ces003",
                                   "fclbmc",
                                   "ces140",
                                   "ces011",
                                   "ces002",
                                   "hsbmw",
                                   "pmcp",
                                   "pwimsa") ,  
           `Long description` = c("Housing Starts:Midwest(Thous.U.)S.A." , 
  "Houses Authorized By Build. Permits:South(Thou.U.)S.A.",
  "Index Of Help-Wanted Advertising In Newspapers (1967=100;Sa)",
  "Interest Rate: U.S.Treasury Const Maturities,1-Yr.(percentage Per Ann,Nsa)",
  "Foreign Exchange Rate: Japan (Yen Per U.S.$)",
  "Foreign Exchange Rate: Canada (Canadian $ Per U.S.$)",
  "Unemploy.By Duration: Average(Mean)Duration In Weeks (Sa)",
  "Employees On Nonfarm Payrolls - Goods-Producing",
  "Wkly Rp Lg Com'l Banks:Net Change Com'l & Indus Loans(Bil$,Saar)",
  "Employees On Nonfarm Payrolls - Government",
  "Employees On Nonfarm Payrolls - Construction",
  "Employees On Nonfarm Payrolls: Total Private",
  "Houses Authorized By Build. Permits:Midwest(Thou.U.)S.A.",
  "Napm Commodity Prices Index (Percent)",
  "Producer Price Index:I ntermed Mat.Supplies & Components(82=100,Sa)"), stringsAsFactors = FALSE) 
#%>% pander(justify = "left" , split.table = Inf , split.cell = 80, style = "grid", caption = "Data description")
write.csv(description, "description.csv")
```

```{r include=F, message=F, warning=F, echo=F, eval=F}
t.bic[colnames(ngraw) == substr(sum3[1,1], 1, nchar(sum3[1,1])-5)]
t.bic[colnames(ngraw) == substr(sum3[2,1], 1, nchar(sum3[2,1])-5)]
t.bic[colnames(ngraw) == substr(sum3[3,1], 3, nchar(sum3[3,1])-5)]
t.bic[colnames(ngraw) == substr(sum3[4,1], 1, nchar(sum3[4,1])-5)]
t.bic[colnames(ngraw) == substr(sum3[5,1], 1, nchar(sum3[5,1])-5)]
t.bic[colnames(ngraw) == substr(sum3[6,1], 1, nchar(sum3[6,1])-5)]
t.bic[colnames(ngraw) == substr(sum3[7,1], 1, nchar(sum3[7,1])-5)]
t.bic[colnames(ngraw) == substr(sum3[8,1], 1, nchar(sum3[8,1])-5)]
t.bic[colnames(ngraw) == substr(sum3[9,1], 1, nchar(sum3[9,1])-5)]
t.bic[colnames(ngraw) == substr(sum3[10,1], 1, nchar(sum3[10,1])-5)]
t.bic[colnames(ngraw) == substr(sum3[11,1], 1, nchar(sum3[11,1])-5)]
```

## yr3 as the dependent variable

* AIC chooses 25 lags for yr3.

* The out-of-sample MSE of AR(25) is 0.077.

* The estimated AR(1) coefficient is 0.934.

```{r include=T, message=F, warning=F, echo=F}
train1.ng = ng1train(data = ngraw, tcode = t.ng, yr=yr3)
train1.aic = ng1train(data = ngraw, tcode = t.aic, yr=yr3)
train1.bic = ng1train(data = ngraw, tcode = t.bic, yr=yr3)
trace1.ng = trace.plot.table(train1.ng$lasso, lambda.seq, train1.ng$lambda)
trace1.aic = trace.plot.table(train1.aic$lasso, lambda.seq, train1.aic$lambda)
trace1.bic = trace.plot.table(train1.bic$lasso, lambda.seq, train1.bic$lambda)
sum1 = sumtable(trace1.ng, trace1.aic, trace1.bic)
mses1 = c("out-of sample MSE", round(train1.ng$mse, digits = 6), 
         round(train1.aic$mse, digits = 6), round(train1.bic$mse, digits = 6))
sum1 = rbind(mses1, sum1)
MSE1 = c(train1.ng$mse, train1.aic$mse, train1.bic$mse)

train2.ng = ng2train(data = ngraw, tcode = t.ng, yr=yr3)
train2.aic = ng2train(data = ngraw, tcode = t.aic, yr=yr3)
train2.bic = ng2train(data = ngraw, tcode = t.bic, yr=yr3)
trace2.ng = trace.plot.table(train2.ng$lasso, lambda.seq, train2.ng$lambda)
trace2.aic = trace.plot.table(train2.aic$lasso, lambda.seq, train2.aic$lambda)
trace2.bic = trace.plot.table(train2.bic$lasso, lambda.seq, train2.bic$lambda)
sum2 = sumtable(trace2.ng, trace2.aic, trace2.bic)
mses2 = c("out-of sample MSE", round(train2.ng$mse, digits = 6), 
         round(train2.aic$mse, digits = 6), round(train2.bic$mse, digits = 6))
sum2 = rbind(mses2, sum2)
MSE2 = c(train2.ng$mse, train2.aic$mse, train2.bic$mse)

train3.ng = ng3train(data = ngraw, tcode = t.ng, yr=yr3)
train3.aic = ng3train(data = ngraw, tcode = t.aic, yr=yr3)
train3.bic = ng3train(data = ngraw, tcode = t.bic, yr=yr3)
trace3.ng = trace.plot.table(train3.ng$lasso, lambda.seq, train3.ng$lambda)
trace3.aic = trace.plot.table(train3.aic$lasso, lambda.seq, train3.aic$lambda)
trace3.bic = trace.plot.table(train3.bic$lasso, lambda.seq, train3.bic$lambda)
sum3 = sumtable(trace3.ng, trace3.aic, trace3.bic)
mses3 = c("out-of sample MSE", round(train3.ng$mse, digits = 6), 
         round(train3.aic$mse, digits = 6), round(train3.bic$mse, digits = 6))
sum3 = rbind(mses3, sum3)
MSE3 = c(train3.ng$mse, train3.aic$mse, train3.bic$mse)
mses = rbind(MSE1, MSE2, MSE3)
colnames(mses) = c("NG", "AIC", "BIC")
rownames(mses) = c("LASSO 1", "LASSO 2", "LASSO 3")
pander(mses, caption = "out-of-sample MSE of LASSO, when the dependent variable is yr3")
# ar
#ar(yr3, aic=TRUE)
maxlag.ar = 25
y = lag0(maxlag = maxlag.ar, yr3) %>% scale()
x = lags(maxlag = maxlag.ar, yr3) 
l = ceiling(length(y)*0.8)
y.train = y[1:l]
y.test = y[(l+1):length(y)]
x.train = x[1:l, ] 
x.test = x[(l+1):dim(x)[1], ]
arols = lm(y.train ~ x.train)
cf = as.data.frame(lapply(arols$coefficients[-1], rep, dim(x.test)[1]))
fit.temp = cf * x.test
fit.ar = rowSums(fit.temp)
out.mse.ar = mean((y.test-fit.ar)^2)
#out.mse.ar
```

## yr4 as the dependent variable

* AIC chooses 25 lags for yr4.

* The out-of-sample MSE of AR(25) is 0.0735.

* The estimated AR(1) coefficient is 0.9342.

```{r include=T, message=F, warning=F, echo=F}
train1.ng = ng1train(data = ngraw, tcode = t.ng, yr=yr4)
train1.aic = ng1train(data = ngraw, tcode = t.aic, yr=yr4)
train1.bic = ng1train(data = ngraw, tcode = t.bic, yr=yr4)
trace1.ng = trace.plot.table(train1.ng$lasso, lambda.seq, train1.ng$lambda)
trace1.aic = trace.plot.table(train1.aic$lasso, lambda.seq, train1.aic$lambda)
trace1.bic = trace.plot.table(train1.bic$lasso, lambda.seq, train1.bic$lambda)
sum1 = sumtable(trace1.ng, trace1.aic, trace1.bic)
mses1 = c("out-of sample MSE", round(train1.ng$mse, digits = 6), 
         round(train1.aic$mse, digits = 6), round(train1.bic$mse, digits = 6))
sum1 = rbind(mses1, sum1)
MSE1 = c(train1.ng$mse, train1.aic$mse, train1.bic$mse)

train2.ng = ng2train(data = ngraw, tcode = t.ng, yr=yr4)
train2.aic = ng2train(data = ngraw, tcode = t.aic, yr=yr4)
train2.bic = ng2train(data = ngraw, tcode = t.bic, yr=yr4)
trace2.ng = trace.plot.table(train2.ng$lasso, lambda.seq, train2.ng$lambda)
trace2.aic = trace.plot.table(train2.aic$lasso, lambda.seq, train2.aic$lambda)
trace2.bic = trace.plot.table(train2.bic$lasso, lambda.seq, train2.bic$lambda)
sum2 = sumtable(trace2.ng, trace2.aic, trace2.bic)
mses2 = c("out-of sample MSE", round(train2.ng$mse, digits = 6), 
         round(train2.aic$mse, digits = 6), round(train2.bic$mse, digits = 6))
sum2 = rbind(mses2, sum2)
MSE2 = c(train2.ng$mse, train2.aic$mse, train2.bic$mse)

train3.ng = ng3train(data = ngraw, tcode = t.ng, yr=yr4)
train3.aic = ng3train(data = ngraw, tcode = t.aic, yr=yr4)
train3.bic = ng3train(data = ngraw, tcode = t.bic, yr=yr4)
trace3.ng = trace.plot.table(train3.ng$lasso, lambda.seq, train3.ng$lambda)
trace3.aic = trace.plot.table(train3.aic$lasso, lambda.seq, train3.aic$lambda)
trace3.bic = trace.plot.table(train3.bic$lasso, lambda.seq, train3.bic$lambda)
sum3 = sumtable(trace3.ng, trace3.aic, trace3.bic)
mses3 = c("out-of sample MSE", round(train3.ng$mse, digits = 6), 
         round(train3.aic$mse, digits = 6), round(train3.bic$mse, digits = 6))
sum3 = rbind(mses3, sum3)
MSE3 = c(train3.ng$mse, train3.aic$mse, train3.bic$mse)
mses = rbind(MSE1, MSE2, MSE3)
colnames(mses) = c("NG", "AIC", "BIC")
rownames(mses) = c("LASSO 1", "LASSO 2", "LASSO 3")
pander(mses, caption = "out-of-sample MSE of LASSO, when the dependent variable is yr4")
#ar(yr5, aic=TRUE)
maxlag.ar = 25
y = lag0(maxlag = maxlag.ar, yr4) %>% scale()
x = lags(maxlag = maxlag.ar, yr4) 
l = ceiling(length(y)*0.8)
y.train = y[1:l]
y.test = y[(l+1):length(y)]
x.train = x[1:l, ] 
x.test = x[(l+1):dim(x)[1], ]
arols = lm(y.train ~ x.train)
cf = as.data.frame(lapply(arols$coefficients[-1], rep, dim(x.test)[1]))
fit.temp = cf * x.test
fit.ar = rowSums(fit.temp)
out.mse.ar = mean((y.test-fit.ar)^2)
#out.mse.ar
```


## yr5 as the dependent variable

* AIC chooses 25 lags for yr5.

* The out-of-sample MSE of AR(25) is 0.066.

* The estimated AR(1) coefficient is 0.9251.

```{r include=T, message=F, warning=F, echo=F}
train1.ng = ng1train(data = ngraw, tcode = t.ng, yr=yr5)
train1.aic = ng1train(data = ngraw, tcode = t.aic, yr=yr5)
train1.bic = ng1train(data = ngraw, tcode = t.bic, yr=yr5)
trace1.ng = trace.plot.table(train1.ng$lasso, lambda.seq, train1.ng$lambda)
trace1.aic = trace.plot.table(train1.aic$lasso, lambda.seq, train1.aic$lambda)
trace1.bic = trace.plot.table(train1.bic$lasso, lambda.seq, train1.bic$lambda)
sum1 = sumtable(trace1.ng, trace1.aic, trace1.bic)
mses1 = c("out-of sample MSE", round(train1.ng$mse, digits = 6), 
         round(train1.aic$mse, digits = 6), round(train1.bic$mse, digits = 6))
sum1 = rbind(mses1, sum1)
MSE1 = c(train1.ng$mse, train1.aic$mse, train1.bic$mse)

train2.ng = ng2train(data = ngraw, tcode = t.ng, yr=yr5)
train2.aic = ng2train(data = ngraw, tcode = t.aic, yr=yr5)
train2.bic = ng2train(data = ngraw, tcode = t.bic, yr=yr5)
trace2.ng = trace.plot.table(train2.ng$lasso, lambda.seq, train2.ng$lambda)
trace2.aic = trace.plot.table(train2.aic$lasso, lambda.seq, train2.aic$lambda)
trace2.bic = trace.plot.table(train2.bic$lasso, lambda.seq, train2.bic$lambda)
sum2 = sumtable(trace2.ng, trace2.aic, trace2.bic)
mses2 = c("out-of sample MSE", round(train2.ng$mse, digits = 6), 
         round(train2.aic$mse, digits = 6), round(train2.bic$mse, digits = 6))
sum2 = rbind(mses2, sum2)
MSE2 = c(train2.ng$mse, train2.aic$mse, train2.bic$mse)

train3.ng = ng3train(data = ngraw, tcode = t.ng, yr=yr5)
train3.aic = ng3train(data = ngraw, tcode = t.aic, yr=yr5)
train3.bic = ng3train(data = ngraw, tcode = t.bic, yr=yr5)
trace3.ng = trace.plot.table(train3.ng$lasso, lambda.seq, train3.ng$lambda)
trace3.aic = trace.plot.table(train3.aic$lasso, lambda.seq, train3.aic$lambda)
trace3.bic = trace.plot.table(train3.bic$lasso, lambda.seq, train3.bic$lambda)
sum3 = sumtable(trace3.ng, trace3.aic, trace3.bic)
mses3 = c("out-of sample MSE", round(train3.ng$mse, digits = 6), 
         round(train3.aic$mse, digits = 6), round(train3.bic$mse, digits = 6))
sum3 = rbind(mses3, sum3)
MSE3 = c(train3.ng$mse, train3.aic$mse, train3.bic$mse)
mses = rbind(MSE1, MSE2, MSE3)
colnames(mses) = c("NG", "AIC", "BIC")
rownames(mses) = c("LASSO 1", "LASSO 2", "LASSO 3")
pander(mses, caption = "out-of-sample MSE of LASSO, when the dependent variable is yr5")
maxlag.ar = 25
y = lag0(maxlag = maxlag.ar, yr5) %>% scale()
x = lags(maxlag = maxlag.ar, yr5) 
l = ceiling(length(y)*0.8)
y.train = y[1:l]
y.test = y[(l+1):length(y)]
x.train = x[1:l, ] 
x.test = x[(l+1):dim(x)[1], ]
arols = lm(y.train ~ x.train)
cf = as.data.frame(lapply(arols$coefficients[-1], rep, dim(x.test)[1]))
fit.temp = cf * x.test
fit.ar = rowSums(fit.temp)
out.mse.ar = mean((y.test-fit.ar)^2)
#out.mse.ar
```
